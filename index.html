<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <title>StoryWeaver</title>
    <link
      rel="stylesheet"
      href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <h1 class="header-title">StoryWeaver</h1>
      <div class="header-subtitle">Create interactive branching stories</div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Toolbar -->
      <div class="toolbar">
        <button
          id="newSceneBtn"
          class="btn btn-primary"
          title="Create New Scene (N)">
          <i data-feather="plus"></i>
          New Scene
        </button>
        <button
          id="previewBtn"
          class="btn btn-secondary"
          title="Preview Story (Space)">
          <i data-feather="play"></i>
          Preview
        </button>
        <button
          id="analyticsBtn"
          class="btn btn-outline"
          title="Learning Analytics">
          <i data-feather="bar-chart-2"></i>
          Analytics
        </button>
        <div class="toolbar-divider"></div>
        <button
          id="storySettingsBtn"
          class="btn btn-outline"
          title="Story Settings">
          <i data-feather="settings"></i>
          Settings
        </button>
        <button
          id="exportJsonBtn"
          class="btn btn-outline"
          title="Export as JSON">
          <i data-feather="download"></i>
          Export JSON
        </button>
        <button
          id="importJsonBtn"
          class="btn btn-outline"
          title="Import JSON">
          <i data-feather="upload"></i>
          Import JSON
        </button>
        <button
          id="exportHtmlBtn"
          class="btn btn-outline"
          title="Export Playable HTML">
          <i data-feather="file-text"></i>
          Export HTML
        </button>
        <div class="toolbar-divider"></div>
        <select
          id="samplesSelect"
          class="samples-select"
          title="Load Sample Stories">
          <option value="">üìö Sample Stories</option>
          <option value="mathAdventure">Math Adventure: Number Kingdom</option>
          <option value="spaceExploration">
            Space Exploration: Mission to Mars
          </option>
          <option value="environmentalHero">
            Environmental Hero: Lake Crystal
          </option>
        </select>
        <button
          id="shareSceneBtn"
          class="btn btn-outline"
          title="Share Selected Scene"
          style="display: none">
          <i data-feather="share-2"></i>
          Share Scene
        </button>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Board Container -->
        <div class="board-container">
          <div
            id="board"
            class="board">
            <svg
              id="connectors"
              class="connectors-layer"></svg>
          </div>
        </div>

        <!-- Inspector Panel -->
        <div
          id="inspector"
          class="inspector">
          <div class="inspector-header">
            <h3>Scene Inspector</h3>
            <button
              id="deleteSceneBtn"
              class="btn btn-danger btn-small"
              title="Delete Scene (Del)"
              style="display: none">
              <i data-feather="trash-2"></i>
            </button>
          </div>

          <div
            id="inspectorContent"
            class="inspector-content">
            <div class="inspector-empty">
              <i data-feather="mouse-pointer"></i>
              <p>Select a scene to edit its content</p>
            </div>
          </div>

          <div
            id="inspectorForm"
            class="inspector-form"
            style="display: none">
            <div class="form-group">
              <label for="sceneTitle">Scene Title</label>
              <input
                type="text"
                id="sceneTitle"
                class="form-control"
                placeholder="Enter scene title" />
            </div>

            <div class="form-group">
              <label for="sceneText">Scene Text</label>
              <textarea
                id="sceneText"
                class="form-control"
                rows="4"
                placeholder="Enter the scene description..."></textarea>
            </div>

            <!-- New Image Section -->
            <div class="form-group">
              <label>Scene Image</label>
              <div class="image-controls">
                <div class="image-type-selector">
                  <label class="radio-label">
                    <input
                      type="radio"
                      name="imageType"
                      value="upload"
                      checked />
                    <span>Upload Image</span>
                  </label>
                  <label class="radio-label">
                    <input
                      type="radio"
                      name="imageType"
                      value="unsplash" />
                    <span>Search Unsplash</span>
                  </label>
                  <label class="radio-label">
                    <input
                      type="radio"
                      name="imageType"
                      value="emoji" />
                    <span>Emoji</span>
                  </label>
                </div>

                <div
                  id="uploadImageControls"
                  class="image-option">
                  <input
                    type="file"
                    id="imageUpload"
                    accept="image/*"
                    class="form-control" />
                  <small class="help-text">Upload JPG, PNG, or GIF files</small>
                </div>

                <div
                  id="unsplashControls"
                  class="image-option"
                  style="display: none">
                  <input
                    type="text"
                    id="unsplashSearch"
                    class="form-control"
                    placeholder="Search for images..." />
                  <button
                    type="button"
                    id="searchUnsplashBtn"
                    class="btn btn-small btn-outline">
                    Search
                  </button>
                  <div
                    id="unsplashResults"
                    class="image-gallery"></div>
                </div>

                <div
                  id="emojiControls"
                  class="image-option"
                  style="display: none">
                  <input
                    type="text"
                    id="emojiInput"
                    class="form-control"
                    placeholder="Enter emoji (e.g., üåü üìö üéì)" />
                  <div class="emoji-suggestions">
                    <span
                      class="emoji-btn"
                      data-emoji="üìö"
                      >üìö</span
                    >
                    <span
                      class="emoji-btn"
                      data-emoji="üéì"
                      >üéì</span
                    >
                    <span
                      class="emoji-btn"
                      data-emoji="üåü"
                      >üåü</span
                    >
                    <span
                      class="emoji-btn"
                      data-emoji="üí°"
                      >üí°</span
                    >
                    <span
                      class="emoji-btn"
                      data-emoji="üéØ"
                      >üéØ</span
                    >
                    <span
                      class="emoji-btn"
                      data-emoji="üöÄ"
                      >üöÄ</span
                    >
                    <span
                      class="emoji-btn"
                      data-emoji="üåç"
                      >üåç</span
                    >
                    <span
                      class="emoji-btn"
                      data-emoji="‚ö°"
                      >‚ö°</span
                    >
                  </div>
                </div>

                <div
                  id="imagePreview"
                  class="image-preview"></div>
              </div>
            </div>

            <!-- Educational Features -->
            <div class="form-group">
              <label for="sceneCategory">Scene Type</label>
              <select
                id="sceneCategory"
                class="form-control">
                <option value="story">Story Content</option>
                <option value="question">Question/Quiz</option>
                <option value="info">Information/Facts</option>
                <option value="decision">Decision Point</option>
              </select>
            </div>

            <div class="form-group">
              <label for="sceneNotes">Teacher Notes</label>
              <textarea
                id="sceneNotes"
                class="form-control"
                rows="2"
                placeholder="Private notes for educators..."></textarea>
            </div>

            <div class="form-group">
              <label for="readTime">Estimated Read Time (minutes)</label>
              <input
                type="number"
                id="readTime"
                class="form-control"
                min="1"
                max="10"
                value="1" />
            </div>

            <div class="choices-section">
              <div class="choices-header">
                <h4>Choices</h4>
                <button
                  id="addChoiceBtn"
                  class="btn btn-small btn-primary">
                  <i data-feather="plus"></i>
                  Add Choice
                </button>
              </div>
              <div
                id="choicesList"
                class="choices-list"></div>
            </div>

            <!-- Hints Section -->
            <div class="hints-section">
              <div class="hints-header">
                <h4>Learning Hints</h4>
                <button
                  id="addHintBtn"
                  class="btn btn-small btn-outline">
                  <i data-feather="help-circle"></i>
                  Add Hint
                </button>
              </div>
              <div
                id="hintsList"
                class="hints-list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Preview Overlay -->
    <div
      id="previewOverlay"
      class="preview-overlay"
      style="display: none">
      <div class="preview-container">
        <div class="preview-header">
          <h2>Story Preview</h2>
          <button
            id="closePreviewBtn"
            class="btn btn-outline">
            <i data-feather="x"></i>
            Back to Editor
          </button>
        </div>
        <div
          id="previewContent"
          class="preview-content">
          <div
            id="previewScene"
            class="preview-scene">
            <h3 id="previewTitle"></h3>
            <p id="previewText"></p>
            <div
              id="previewChoices"
              class="preview-choices"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Story Settings Modal -->
    <div
      id="settingsModal"
      class="modal-overlay"
      style="display: none">
      <div class="modal-container">
        <div class="modal-header">
          <h2>Story Settings</h2>
          <button
            id="closeSettingsBtn"
            class="btn btn-outline">
            <i data-feather="x"></i>
          </button>
        </div>
        <div class="modal-content">
          <div class="form-group">
            <label for="storyTitle">Story Title</label>
            <input
              type="text"
              id="storyTitle"
              class="form-control"
              placeholder="Enter story title" />
          </div>
          <div class="form-group">
            <label for="storyDescription">Description</label>
            <textarea
              id="storyDescription"
              class="form-control"
              rows="3"
              placeholder="Brief description of the story"></textarea>
          </div>
          <div class="form-group">
            <label for="storySubject">Subject</label>
            <select
              id="storySubject"
              class="form-control">
              <option value="General">General</option>
              <option value="Mathematics">Mathematics</option>
              <option value="Science">Science</option>
              <option value="History">History</option>
              <option value="Language Arts">Language Arts</option>
              <option value="Social Studies">Social Studies</option>
              <option value="Art">Art</option>
              <option value="Music">Music</option>
              <option value="Physical Education">Physical Education</option>
            </select>
          </div>
          <div class="form-group">
            <label for="storyDifficulty">Difficulty Level</label>
            <select
              id="storyDifficulty"
              class="form-control">
              <option value="Beginner">Beginner</option>
              <option value="Intermediate">Intermediate</option>
              <option value="Advanced">Advanced</option>
            </select>
          </div>
          <div class="form-group">
            <label for="learningObjectives">Learning Objectives</label>
            <textarea
              id="learningObjectives"
              class="form-control"
              rows="3"
              placeholder="What will students learn? (one per line)"></textarea>
          </div>
          <div class="form-group">
            <label for="storyTags">Tags</label>
            <input
              type="text"
              id="storyTags"
              class="form-control"
              placeholder="Enter tags separated by commas" />
          </div>
        </div>
        <div class="modal-footer">
          <button
            id="saveSettingsBtn"
            class="btn btn-primary">
            Save Settings
          </button>
        </div>
      </div>
    </div>

    <!-- Analytics Modal -->
    <div
      id="analyticsModal"
      class="modal-overlay"
      style="display: none">
      <div class="modal-container large">
        <div class="modal-header">
          <h2>Learning Analytics</h2>
          <button
            id="closeAnalyticsBtn"
            class="btn btn-outline">
            <i data-feather="x"></i>
          </button>
        </div>
        <div class="modal-content">
          <div class="analytics-grid">
            <div class="analytics-card">
              <h3>Story Overview</h3>
              <div id="storyStats"></div>
            </div>
            <div class="analytics-card">
              <h3>Scene Distribution</h3>
              <div id="sceneChart"></div>
            </div>
            <div class="analytics-card">
              <h3>Complexity Analysis</h3>
              <div id="complexityStats"></div>
            </div>
            <div class="analytics-card">
              <h3>Learning Path</h3>
              <div id="pathAnalysis"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hidden File Input for Import -->
    <input
      type="file"
      id="fileInput"
      accept=".json"
      style="display: none" />

    <!-- Loading Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>
    <script src="app.js"></script>
    <script>
      // Initialize feather icons
      feather.replace();

      // Initialize the application
      window.addEventListener("DOMContentLoaded", () => {
        initApp();
      });
    </script>
  </body>
</html>
